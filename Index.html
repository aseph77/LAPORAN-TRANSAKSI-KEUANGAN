<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pencatat Keuangan Pro</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        :root { --primary: #2563eb; --success: #16a34a; --bg: #f8fafc; --dark: #1e293b; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); margin: 0; padding: 15px; }
        .container { max-width: 600px; margin: auto; background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
        .header { text-align: center; margin-bottom: 20px; }
        .summary-box { background: var(--dark); color: white; padding: 15px; border-radius: 10px; text-align: center; margin-bottom: 20px; }
        .summary-box h2 { margin: 5px 0; color: #4ade80; }
        
        .input-section { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .full { grid-column: span 2; }
        label { font-size: 12px; font-weight: bold; display: block; margin-bottom: 5px; color: #64748b; }
        input, select { width: 100%; padding: 12px; border: 1px solid #e2e8f0; border-radius: 8px; box-sizing: border-box; margin-bottom: 10px; }
        
        .btn-group { display: flex; gap: 10px; margin-top: 10px; }
        button { flex: 1; padding: 12px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; color: white; }
        .btn-add { background: var(--primary); }
        .btn-excel { background: var(--success); }

        table { width: 100%; border-collapse: collapse; margin-top: 20px; font-size: 13px; }
        th { text-align: left; padding: 10px; border-bottom: 2px solid #f1f5f9; color: #64748b; }
        td { padding: 10px; border-bottom: 1px solid #f1f5f9; }
        .badge { padding: 3px 6px; border-radius: 4px; font-size: 11px; color: white; font-weight: bold; }
        .bg-blue { background: #3b82f6; }
        .bg-orange { background: #f59e0b; }
        .bg-green { background: #10b981; }
        .delete-ico { color: #ef4444; cursor: pointer; font-weight: bold; }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h3>Riwayat Transaksi</h3>
    </div>

    <div class="summary-box">
        <small>Total Omzet</small>
        <h2 id="totalDisplay">Rp 0</h2>
    </div>

    <div class="input-section">
        <div>
            <label>Jenis</label>
            <select id="jenis">
                <option value="Transfer">Transfer</option>
                <option value="Tarik Tunai">Tarik Tunai</option>
                <option value="Pulsa">Pulsa</option>
                <option value="Kuota">Kuota</option>
                <option value="Token PLN">Token PLN</option>
            </select>
        </div>
        <div>
            <label>Nominal</label>
            <input type="number" id="nominal" placeholder="0">
        </div>
        <div class="full">
            <label>Keterangan</label>
            <input type="text" id="keterangan" placeholder="Nama pelanggan / tujuan">
        </div>
    </div>

    <div class="btn-group">
        <button class="btn-add" onclick="tambahData()">Simpan</button>
        <button class="btn-excel" onclick="exportKeExcel()">Download Excel</button>
    </div>

    <table id="tabelUtama">
        <thead>
            <tr>
                <th>Tanggal</th>
                <th>Jenis</th>
                <th>Ket</th>
                <th>Jumlah</th>
                <th></th>
            </tr>
        </thead>
        <tbody id="isiTabel"></tbody>
    </table>
</div>

<script>
    function renderTabel() {
        const data = JSON.parse(localStorage.getItem('db_transaksi')) || [];
        const container = document.getElementById('isiTabel');
        const totalDisp = document.getElementById('totalDisplay');
        container.innerHTML = '';
        let total = 0;

        data.slice().reverse().forEach((item, index) => {
            const realIndex = data.length - 1 - index;
            total += parseInt(item.nominal);
            
            let color = item.jenis === 'Transfer' ? 'bg-blue' : (item.jenis === 'Pulsa' ? 'bg-orange' : 'bg-green');
            
            container.innerHTML += `
                <tr>
                    <td>${item.tanggal}</td>
                    <td><span class="badge ${color}">${item.jenis}</span></td>
                    <td>${item.keterangan}</td>
                    <td>${parseInt(item.nominal).toLocaleString('id-ID')}</td>
                    <td><span class="delete-ico" onclick="hapusData(${realIndex})">âœ•</span></td>
                </tr>
            `;
        });
        totalDisp.innerText = "Rp " + total.toLocaleString('id-ID');
    }

    function tambahData() {
        const j = document.getElementById('jenis').value;
        const k = document.getElementById('keterangan').value;
        const n = document.getElementById('nominal').value;
        const t = new Date().toLocaleDateString('id-ID');

        if(!k || !n) return alert("Isi data dengan lengkap!");

        const data = JSON.parse(localStorage.getItem('db_transaksi')) || [];
        data.push({ tanggal: t, jenis: j, keterangan: k, nominal: parseInt(n) });
        localStorage.setItem('db_transaksi', JSON.stringify(data));
        
        document.getElementById('keterangan').value = '';
        document.getElementById('nominal').value = '';
        renderTabel();
    }

    function hapusData(i) {
        if(confirm('Hapus data ini?')) {
            const data = JSON.parse(localStorage.getItem('db_transaksi'));
            data.splice(i, 1);
            localStorage.setItem('db_transaksi', JSON.stringify(data));
            renderTabel();
        }
    }

    function exportKeExcel() {
        const data = JSON.parse(localStorage.getItem('db_transaksi')) || [];
        if(data.length === 0) return alert("Tidak ada data!");

        // Format data untuk Excel
        const dataExcel = data.map(item => ({
            "Tanggal": item.tanggal,
            "Kategori": item.jenis,
            "Keterangan": item.keterangan,
            "Nominal (Rp)": item.nominal
        }));

        // Proses pembuatan file Excel
        const worksheet = XLSX.utils.json_to_sheet(dataExcel);
        const workbook = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(workbook, worksheet, "Laporan");

        // Download file
        XLSX.writeFile(workbook, "Laporan_Keuangan_" + new Date().toLocaleDateString('id-ID') + ".xlsx");
    }

    renderTabel();
</script>

</body>
</html>
